# AI Agent Instructions for scriptify

## Required Reading for AI Agents

When starting work on this repository, please read the following documents in order:

### 1. Project Overview
- `README.md` - Project description, features, and usage examples
- `CHANGELOG.md` - Recent changes and version history
- `Cargo.toml` - Dependencies and project metadata

### 2. Development Guidelines
- `CONTRIBUTING.md` - Development workflow and contribution guidelines
- `docs/DEVELOPMENT.md` - Detailed development processes and project structure

### 3. Codebase Structure
```
scriptify/
├── src/lib.rs              # Main documentation (README source)
├── src/cmd.rs              # Command execution functionality
├── src/fs.rs               # File system operations
├── src/echo.rs             # Output formatting
├── src/color.rs            # Color definitions
├── src/style.rs            # Style utilities
├── examples/               # Usage examples
└── xtask/                  # Development task runner
```

## Key Development Rules

### Documentation Management
- **NEVER edit README.md directly** - it's auto-generated from `src/lib.rs`
- To update README: edit `src/lib.rs` docstring and run `cargo xtask readme`
- Always regenerate README after changing `src/lib.rs` documentation

### Code Quality
- Run `cargo xtask ci` before any commits
- Use `cargo xtask fmt` for formatting (required)
- All code must pass clippy lints
- Write tests for new functionality

### Platform Considerations
- Primary platforms: Linux and macOS
- Windows: Limited support with automatic fallbacks
- Use Unix-compatible commands in examples
- Test native pipeline features on Rust 1.87.0+

### Recent Important Changes
- Implemented efficient native pipelines using `std::io::pipe` (Rust 1.87.0+)
- Consolidated `src/cmd/` module structure to single `src/cmd.rs` file
- Added automatic fallback for shell-based pipes on older Rust versions

### Testing Strategy
- All examples should work on Unix systems
- Use `.quiet()` in tests to avoid cluttering output
- Test both native and fallback pipeline implementations
- Performance examples demonstrate streaming efficiency

### Commit Guidelines
- Use conventional commit format
- Test locally with `cargo xtask ci` before committing
- Update documentation in `src/lib.rs` when adding features
- Separate logical changes into different commits

## Before Making Changes

1. Read the specific files relevant to your task
2. Run `cargo test` to ensure current state is working
3. Understand the pipeline implementation (native vs fallback)
4. Check if README regeneration is needed after changes

## Common Tasks

- **Add new command feature**: Modify `src/cmd.rs`, add tests, update `src/lib.rs` docs
- **Add example**: Create in `examples/`, ensure Unix compatibility
- **Fix performance**: Focus on pipeline implementation in `src/cmd.rs`
- **Update docs**: Edit `src/lib.rs` docstring, then run `cargo xtask readme`